{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/User/Desktop/jbook/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/User/Desktop/jbook/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import*as esbuild from'esbuild-wasm';import{unpkgPathPlugin}from'./plugins/unpkg-path-plugin';import{fetchPlugin}from'./plugins/fetch-plugin';// bundle our code\nvar service;var bundle=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(rawCode){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(service){_context.next=4;break;}_context.next=3;return esbuild.startService({worker:true,wasmURL:'http://unpkg.com/esbuild-wasm@0.8.27/esbuild.wasm'});case 3:service=_context.sent;case 4:_context.prev=4;_context.next=7;return service.build({entryPoints:['index.js'],bundle:true,write:false,plugins:[unpkgPathPlugin(),fetchPlugin(rawCode)],// defines for bundling\ndefine:{'process.env.NODE_ENV':'\"production\"',global:'window'},jsxFactory:'_React.createElement',jsxFragment:'_React.Fragment'});case 7:result=_context.sent;return _context.abrupt(\"return\",{code:result.outputFiles[0].text,err:''});case 11:_context.prev=11;_context.t0=_context[\"catch\"](4);return _context.abrupt(\"return\",{code:'',err:_context.t0.message});case 14:case\"end\":return _context.stop();}}},_callee,null,[[4,11]]);}));return function bundle(_x){return _ref.apply(this,arguments);};}();export default bundle;","map":{"version":3,"sources":["C:/Users/User/Desktop/jbook/src/bundler/index.ts"],"names":["esbuild","unpkgPathPlugin","fetchPlugin","service","bundle","rawCode","startService","worker","wasmURL","build","entryPoints","write","plugins","define","global","jsxFactory","jsxFragment","result","code","outputFiles","text","err","message"],"mappings":"iSAAA,MAAO,GAAKA,CAAAA,OAAZ,KAAyB,cAAzB,CACA,OAASC,eAAT,KAAgC,6BAAhC,CACA,OAASC,WAAT,KAA4B,wBAA5B,CAEA;AACA,GAAIC,CAAAA,OAAJ,CACA,GAAMC,CAAAA,MAAM,0FAAG,iBAAOC,OAAP,gIAENF,OAFM,+CAGSH,CAAAA,OAAO,CAACM,YAAR,CAAqB,CACjCC,MAAM,CAAE,IADyB,CAEjCC,OAAO,CAAE,mDAFwB,CAArB,CAHT,QAGPL,OAHO,4DAUcA,CAAAA,OAAO,CAACM,KAAR,CAAc,CAC/BC,WAAW,CAAE,CAAC,UAAD,CADkB,CAE/BN,MAAM,CAAE,IAFuB,CAG/BO,KAAK,CAAE,KAHwB,CAI/BC,OAAO,CAAE,CACLX,eAAe,EADV,CACcC,WAAW,CAACG,OAAD,CADzB,CAJsB,CAQ/B;AACAQ,MAAM,CAAE,CACJ,uBAAwB,cADpB,CAEJC,MAAM,CAAE,QAFJ,CATuB,CAa/BC,UAAU,CAAE,sBAbmB,CAc/BC,WAAW,CAAE,iBAdkB,CAAd,CAVd,QAUDC,MAVC,+CA0BA,CACHC,IAAI,CAAED,MAAM,CAACE,WAAP,CAAmB,CAAnB,EAAsBC,IADzB,CAEHC,GAAG,CAAE,EAFF,CA1BA,4FA+BA,CACHH,IAAI,CAAE,EADH,CAEHG,GAAG,CAAE,YAAIC,OAFN,CA/BA,uEAAH,kBAANlB,CAAAA,MAAM,4CAAZ,CAwCA,cAAeA,CAAAA,MAAf","sourcesContent":["import * as esbuild from 'esbuild-wasm'\r\nimport { unpkgPathPlugin } from './plugins/unpkg-path-plugin'\r\nimport { fetchPlugin } from './plugins/fetch-plugin'\r\n\r\n// bundle our code\r\nlet service: esbuild.Service\r\nconst bundle = async (rawCode: string) => {\r\n    // check if service has been started, if not start it\r\n    if (!service) {\r\n        service = await esbuild.startService({\r\n            worker: true,\r\n            wasmURL: 'http://unpkg.com/esbuild-wasm@0.8.27/esbuild.wasm'\r\n        })\r\n    }\r\n\r\n    try {\r\n        const result = await service.build({\r\n            entryPoints: ['index.js'],\r\n            bundle: true,\r\n            write: false,\r\n            plugins: [\r\n                unpkgPathPlugin(), fetchPlugin(rawCode)\r\n            ],\r\n            \r\n            // defines for bundling\r\n            define: {\r\n                'process.env.NODE_ENV': '\"production\"',\r\n                global: 'window'\r\n            },\r\n            jsxFactory: '_React.createElement',\r\n            jsxFragment: '_React.Fragment'\r\n        })\r\n        return {\r\n            code: result.outputFiles[0].text,\r\n            err: ''\r\n        }\r\n    } catch (err) {\r\n        return {\r\n            code: '',\r\n            err: err.message\r\n        }\r\n    }\r\n\r\n    \r\n}\r\n\r\nexport default bundle"]},"metadata":{},"sourceType":"module"}